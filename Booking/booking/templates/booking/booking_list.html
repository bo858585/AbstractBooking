{% extends "base.html" %}

{% block content %}

{% if user.is_authenticated %}

<h1>Список заказов</h1>

<div class="table-responsive">
<table class="table" id="example">
  <thead>
    <tr>
      <th>Название</th>
      <th>Текст</th>
      <th>Цена</th>
      <th>Статус</th>
      <th>Заказчик</th>
      <th>Исполнитель</th>
      <th>Дата создания</th>
      <th>Ваши действия</th>
    </tr>
  </thead>
  <tbody>
    {% load staticfiles %}
    <script src="{% static 'js/booking.js' %}"></script>

    {% for booking in bookings %}
    <tr>
      <td>{{ booking.0.title }}</td>
      <td>{{ booking.0.text|linebreaks }}</p></td>
      <td>{{ booking.0.price }}</td>
      <td>
        {% if booking.0.status == "pending" %}
            {% if booking.1 == 'not_active' %}
                Неактивен
            {% else %}
                Ожидает выполнения
            {% endif %}
        {% else %}
            {% if booking.0.status == "running" %}
                Взят на исполнение
            {% else %}
                {% if booking.0.status == "completed" %}
                    Завершен
                {% endif %}
            {% endif %}
        {% endif %}
      </td>
      <td>{{ booking.0.customer }}</td>
      <td>{% if booking.0.performer %} {{ booking.0.performer }} {% else %} Нет {% endif %}</td>
      <td>{{ booking.0.date|date:'Y-m-d H:i' }}</td>
      <td>
          {% if booking.1 == 'can_take' %}
              {% include "booking/serve.html" with val=booking.0 %}
          {% endif %}
          {% if booking.1 == 'can_view' %}
          {% endif %}
          {% if booking.1 == 'can_complete' %}
              {% include "booking/complete.html" with val=booking.0 %}
          {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>

{% if is_paginated %}
<div align="center" class="pagination">
  <span class="page-links">
    {% if page_obj.has_previous %}
        <a href="/booking/booking_list/?page={{ page_obj.previous_page_number }}">предыдущая</a>
    {% endif %}
    <span class="page-current">
      Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
    </span>
    {% if page_obj.has_next %}
        <a href="/booking/booking_list/?page={{ page_obj.next_page_number }}">следующая</a>
    {% endif %}
  </span>
</div>
{% endif %}

{% endif %}

{% endblock %}
